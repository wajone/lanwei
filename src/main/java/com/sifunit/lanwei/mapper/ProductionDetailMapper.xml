<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sifunit.lanwei.mapper.ProductionDetailMapper">
  <resultMap type="com.sifunit.lanwei.vo.ProductionDetail" id="productionDetail">
    <id column="production_id" property="productionId"/>
    <result column="production_no" property="productionNo"/>
    <result column="contact_no" property="contactNo"/>
    <result column="export_no" property="exportNo"/>
    <result column="customer_id" property="customerId"/>
    <result column="customer_name" property="customerName"/>
    <result column="create_time" property="createTime"/>
    <result column="advance_time" property="advanceTime"/>
    <result column="real_time" property="realTime"/>
    <result column="is_completed" property="isCompleted"/>
    <result column="level" property="level"/>
    <collection property="products" ofType="com.sifunit.lanwei.vo.ProductDetail" column="production_id" select="getProducts"/>
  </resultMap>

  <sql id="Base_Column_List">
    production_id, production_no, contact_no, export_no, a.customer_id, a.create_time, advance_time,
    real_time, is_completed, level
  </sql>

  <select id="list" resultMap="productionDetail">
    SELECT
    <include refid="Base_Column_List" />
    ,b.customer_name
    FROM t_production a
    LEFT JOIN
        t_customer b
    ON b.customer_id = a.customer_id

  </select>
  
  <resultMap id="productDetailMap" type="com.sifunit.lanwei.vo.ProductDetail">
    <result column="product_id" property="productId" />
    <result column="product_serial" property="productSerial" />
    <result column="product_num" property="productNum" />
    <result column="product_color" property="productColor" />
    <result column="production_desc" property="productionDesc" />
    <result column="product_name" property="productName" />
    <result column="product_no" property="productNo" />
    <result column="image_url" property="imageUrl" />
    <result column="product_size" property="productSize" />
    <result column="attach_info" property="attachInfo" />
    <result column="product_cate_id" property="productCateId" />
    <result column="product_cate_name" property="productCateName" />
    <result column="product_desc" property="productDesc" />
    <collection property="procedures" ofType="com.sifunit.lanwei.vo.ProceDetail" column="product_id" select="getProdedures"/>
  </resultMap>

  <select id="getProducts" resultMap="productDetailMap">
    SELECT
      a.product_id,a.product_serial,a.product_num,a.product_color,a.production_desc,b.product_name,b.product_no,b.image_url,b.product_size,b.attach_info,
           b.product_cate_id,b.product_cate_name,b.product_desc
    FROM
      t_production_detail a
    LEFT JOIN
          t_product b
    ON
        a.product_id = b.product_id
    WHERE
        a.production_id = #{product_id}
  </select>

  <resultMap id="proceDetailMap" type="com.sifunit.lanwei.vo.ProceDetail">
    <result column="proce_id" property="proceId" />
    <result column="completed_num" property="completedNum" />
    <result column="goal_num" property="goalNum" />
    <result column="proce_no" property="proceNo" />
    <result column="proce_name" property="proceName" />
    <result column="proce_desc" property="proceDesc" />
  </resultMap>

  <select id="getProdedures" resultMap="proceDetailMap">
    SELECT
        a.proce_id,a.completed_num,a.goal_num,b.proce_no,b.proce_name,b.proce_desc
    FROM
        t_progress a
    LEFT JOIN
        t_procedure b
    ON
        a.proce_id = b.proce_id
    WHERE
        a.product_id = #{product_id}
  </select>
</mapper>